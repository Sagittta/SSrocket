<!DOCTYPE html>
<html lang="ko">
    <head>
        {% load static %}
        <meta charset="utf-8">
        <link rel="stylesheet" href="{% static 'css/signup1.css' %}" type="text/css"> <!--signup.css 링크-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script type="text/javascript"></script>
        <script src="{% static 'js/signup.js' %}"></script> <!--signup.js 링크-->
        <title>signup</title>
    </head>

    <script>
        /* 중복체크! */
        $(function(){
            /* 아이디 수정했을 때 */
            $('#email').change(function () {
                $('#signup_reemail').show();
            });
    
            // 중복확인 버튼을 눌렀을 때
            $('#signup_reemail').click(function(){
                var email = $('#email').val()
                // 이메일 란이 공백일 경우
                if(email == ''){
                    alert('이메일을 입력해주세요.')
                    return;
                }
    
                $.ajax({
                    url:'checkEmail?email='+email,
                    type:'get',
                    dataType:'json',
                    success:function(response){
                        if(response.result != 'success'){
                            console.error(response.data)
                            return;
                        }
                        if(response.data == 'exist'){
                            alert("존재하는 이메일 입니다!");
                            $('#email').val('').focus();
                            return;
                        }else{
                            alert("사용 가능한 이메일입니다!");
                            $("#join_bt").attr("id_check_result", "success");
                            return;
                        }
                        // console.log(response)
                    },
                    error : function(xhr, error){
                        alert("서버와의 통신에서 문제가 발생했습니다.");
                        console.error("error : " + error);
                    }
                })
            });
    
            $('#join-form').submit(function() {
                if($("#join_bt").attr("id_check_result") == "fail") {
                    alert("이메일 중복 확인를 해주시기 바랍니다.");
                    $("#email").focus();
                    return false;
                }
            });
        
            $("#email").on("propertychange change keyup paste input", function(){
                $('#signup_reemail').show();
                $("#join_bt").attr("id_check_result", "fail");
            });
        });
    </script>
    
    <body>
        {% load static %}
        <div id="container">
        <img id="signup_logo" name="signup_logo" src="{% static 'img/logotype.png' %}"> <!--회원가입 로고 삽입-->

        <form id="join-form">

            <img id="signup_name" name="signup_name" src="{% static 'img/bar-op.png' %}"> <!--회원가입 이름 박스 삽입-->
            <input type="text" name="s_name" id="s_name" placeholder="이름을 작성해주세요!" onFocus="clearText(this)"/>

            <img id="signup_email" name="signup_email" src="{% static 'img/bar-op.png' %}"> <!--회원가입 이메일 박스 삽입-->
            <input type="email" name="email" id="email" placeholder="E-mail" onFocus="clearText(this)"/>

            <input type='image' id="signup_reemail" name="signup_reemail" src="{% static 'img/bar-recheck.png' %}"> <!--회원가입 이메일 중복확인 박스 삽입-->
            
            <img id="signup_pw" name="signup_pw" src="{% static 'img/bar-op.png' %}"> <!--회원가입 비밀번호 박스 삽입-->
            <input type="text" name="pw" id="pw" placeholder="Password" onFocus="clearText(this)"/>

            <img id="signup_repw" name="signup_repw" src="{% static 'img/bar-op.png' %}"> <!--회원가입 비밀번호 재확인 박스 삽입-->
            <input type="password" name="repw" id="repw" onFocus="clearText(this)" onchange="check(this)"/>
            <input type='image'id="join_bt" name="join_bt" src="{% static 'img/bar-join.png' %}" alt="Submit"><!--가입하기 버튼 삽입-->
        </form>
       
        </div>
    </body>
</html>